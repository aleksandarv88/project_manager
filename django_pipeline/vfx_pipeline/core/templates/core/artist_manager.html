{% extends 'core/base.html' %}

{% block title %}Artist Manager<script>
  document.addEventListener('DOMContentLoaded', () => {
    const statusSelect = document.getElementById('status_filter');
    if (statusSelect) {
      statusSelect.addEventListener('change', () => {
        statusSelect.form.submit();
      });
    }
  });
</script>

{% endblock %}

{% block content %}
<style>
  .artist-admin-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 2.5rem;
    align-items: flex-start;
  }

  .panel {
    background: linear-gradient(135deg, #2d2d33 0%, #242429 100%);
    border-radius: 14px;
    padding: 24px;
    box-shadow: 0 14px 24px rgba(0, 0, 0, 0.35);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .form-panel {
    flex: 1 1 320px;
    max-width: 420px;
  }

  .form-panel h2,
  .roster-panel h2 {
    margin: 0 0 18px;
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: #fdfdfd;
  }

  .artist-form {
    display: grid;
    gap: 16px;
  }

  .field-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .field-row label {
    font-weight: 600;
    color: #d9d9e3;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.06em;
  }

  .field-row input,
  .field-row select,
  .field-row textarea {
    background: rgba(20, 20, 26, 0.85);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    padding: 10px 12px;
    color: #f5f5f5;
    font-size: 0.95rem;
    transition: border 0.2s ease, box-shadow 0.2s ease;
  }

  .field-row input:focus,
  .field-row select:focus,
  .field-row textarea:focus {
    border-color: #5bc0de;
    box-shadow: 0 0 0 3px rgba(91, 192, 222, 0.25);
    outline: none;
  }

  .field-row input[readonly],
  .field-row input[disabled] {
    background: rgba(46, 46, 56, 0.95);
    color: #fdfdfd;
    cursor: not-allowed;
  }

  .field-row input[type="file"] {
    color: #f5f5f5;
  }

  .field-row input[type="file"]::file-selector-button,
  .field-row input[type="file"]::-webkit-file-upload-button {
    background: rgba(16, 16, 22, 0.95);
    color: #f5f5f5;
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 999px;
    padding: 8px 18px;
    font-weight: 600;
    cursor: pointer;
    transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  }

  .field-row input[type="file"]::file-selector-button:hover,
  .field-row input[type="file"]::-webkit-file-upload-button:hover {
    background: rgba(30, 30, 42, 0.95);
    border-color: rgba(91, 192, 222, 0.4);
    box-shadow: 0 0 0 3px rgba(91, 192, 222, 0.2);
  }

  .field-errors {
    color: #ff8b8b;
    font-size: 0.8rem;
  }

  .btn {
    border: none;
    border-radius: 999px;
    padding: 10px 18px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .btn-secondary {
    background: linear-gradient(135deg, #5bc0de 0%, #3fa9c7 100%);
    color: #0d1b26;
  }

  .btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #d64545 100%);
    color: #fff;
  }

  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
  }

  .filter-bar {
    display:flex;
    align-items:center;
    gap:0.75rem;
    margin-bottom:16px;
  }
  .filter-bar label {
    font-size:0.75rem;
    text-transform:uppercase;
    letter-spacing:0.05em;
    color:#b9bed0;
    font-weight:600;
  }
  .filter-bar select {
    background: rgba(20, 20, 26, 0.85);
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    padding: 8px 14px;
    color: #f5f5f5;
  }
  .filter-bar button {
    border: none;
    border-radius: 999px;
    padding: 8px 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #5bc0de 0%, #3fa9c7 100%);
    color: #0d1b26;
    cursor: pointer;
  }
  .filter-bar button:hover {
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
  }

  .roster-panel {
    flex: 1 1 520px;
    overflow-x: auto;
  }

  table.artist-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: rgba(36, 36, 42, 0.95);
    border-radius: 14px;
    overflow: hidden;
  }

  table.artist-table th,
  table.artist-table td {
    padding: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    vertical-align: middle;
    color: #f6f6fb;
    font-size: 0.92rem;
  }

  table.artist-table th {
    background: rgba(17, 17, 22, 0.92);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-size: 0.75rem;
  }

  table.artist-table tbody tr:hover {
    background: rgba(91, 192, 222, 0.12);
  }

  .artist-table tbody tr.status-active {
    background: rgba(76, 175, 80, 0.18);
  }
  .artist-table tbody tr.status-inactive {
    background: rgba(96, 96, 112, 0.18);
  }
  .artist-table tbody tr.status-vacation {
    background: rgba(63, 138, 187, 0.18);
  }
  .status-form {
    display: inline;
    margin: 0;
  }

  .status-select {
    background: rgba(18, 18, 24, 0.95);
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    padding: 6px 26px 6px 12px;
    color: #f5f5f5;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  }

  .status-select:focus {
    border-color: #5bc0de;
    box-shadow: 0 0 0 3px rgba(91, 192, 222, 0.25);
    outline: none;
  }

  .status-select.status-active {
    background: rgba(34, 124, 58, 0.75);
    border-color: rgba(34, 124, 58, 0.9);
    color: #f5f5f5;
  }

  .status-select.status-inactive {
    background: rgba(64, 64, 84, 0.85);
    border-color: rgba(64, 64, 84, 1);
    color: #f5f5f5;
  }

  .status-select.status-vacation {
    background: rgba(36, 98, 138, 0.78);
    border-color: rgba(36, 98, 138, 0.95);
    color: #f5f5f5;
  }

  .status-select option {
    background: #1a1a23;
    color: #f5f5f5;
  }

  .status-select optgroup {
    background: #1a1a23;
    color: #f5f5f5;
  }

  .status-tag {
    display:inline-block;
    padding:4px 10px;
    border-radius:999px;
    font-size:0.75rem;
    letter-spacing:0.05em;
    text-transform:uppercase;
    font-weight:600;
  }
  .status-tag.status-active {
    background: linear-gradient(135deg, #5fd27c 0%, #2b9b46 100%);
    color:#0d2414;
  }
  .status-tag.status-inactive {
    background: linear-gradient(135deg, #73737d 0%, #4b4b55 100%);
    color:#f4f4f6;
  }
  .status-tag.status-vacation {
    background: linear-gradient(135deg, #58b0e0 0%, #2f6f94 100%);
    color:#0d1f2b;
  }

  .avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(91, 192, 222, 0.35);
  }

  .avatar-placeholder {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #c7c7d9;
  }

  .actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .actions a {
    color: #5bc0de;
    text-decoration: none;
    font-weight: 600;
  }

  .actions a:hover {
    text-decoration: underline;
  }
</style>

<h1>Artist Manager</h1>

<div class="artist-admin-wrapper">
  <div class="panel form-panel">
    <h2>Create Artist</h2>
    <form method="post" enctype="multipart/form-data" class="artist-form">
      {% csrf_token %}
      {% for field in artist_form %}
      {% if field.name != "professional_email" %}
        <div class="field-row">
          {{ field.label_tag }}
          {{ field }}
          {% if field.help_text %}
            <small style="color:#a8d8eb; font-size:0.75rem;">{{ field.help_text }}</small>
          {% endif %}
          {% if field.errors %}
            <div class="field-errors">
              {% for error in field.errors %}{{ error }}<br>{% endfor %}
            </div>
          {% endif %}
        </div>
      {% endif %}
      {% endfor %}
      {% if artist_form.non_field_errors %}
        <div class="field-errors">{{ artist_form.non_field_errors }}</div>
      {% endif %}
      <input type="hidden" name="status_filter" value="{{ status_filter }}">
      <button type="submit" name="add_artist" class="btn btn-secondary">Create Artist</button>
    </form>
  </div>

  <div class="panel roster-panel">
    <h2>Studio Artists</h2>
    <form method="get" class="filter-bar">
      <label for="status_filter">Status</label>
      <select id="status_filter" name="status">
        {% for value,label in status_choices %}
          <option value="{{ value }}" {% if value == status_filter %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
          </form>
    <table class="artist-table">
      <thead>
        <tr>
          <th>Photo</th>
          <th>Artist</th>
          <th>Country</th>
          <th>Experience</th>
          <th>Private Email</th>
          <th>Professional Email</th>
          <th>Status</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for artist in artists %}
          <tr class="artist-row status-{{ artist.status }}">
            <td>
              {% if artist.image %}
                <img src="{{ artist.image.url }}" alt="{{ artist.username }}" class="avatar">
              {% else %}
                <div class="avatar-placeholder">{{ artist.username|slice:":1"|upper }}</div>
              {% endif %}
            </td>
            <td>
              <div style="display:flex; flex-direction:column; gap:4px;">
                <a href="{% url 'artist_info' artist.id %}">{{ artist.username }}</a>
              </div>
            </td>
            <td>{{ artist.country|default:"-" }}</td>
            <td>{{ artist.years_experience }} yrs</td>
            <td>{{ artist.private_email|default:"-" }}</td>
            <td>{{ artist.professional_email|default:"-" }}</td>
            <td>
              <form method="post" class="status-form">
                {% csrf_token %}
                <input type="hidden" name="status_filter" value="{{ status_filter }}">
                <input type="hidden" name="artist_id" value="{{ artist.id }}">
                <input type="hidden" name="update_artist_status" value="1">
                <select name="artist_status" class="status-select status-{{ artist.status }}" onchange="this.form.submit()">
                  {% for value, label in artist_status_choices %}
                    <option value="{{ value }}" {% if artist.status == value %}selected{% endif %}>{{ label }}</option>
                  {% endfor %}
                </select>
              </form>
            </td>
            <td>{{ artist.joined_at|date:"Y-m-d" }}</td>
            <td>
              <div class="actions">
                <a href="{% url 'artist_info' artist.id %}">Edit</a>
                <form method="post" style="display:inline;">
                <input type="hidden" name="status_filter" value="{{ status_filter }}">
                  {% csrf_token %}
                  <input type="hidden" name="delete_artist_id" value="{{ artist.id }}">
                  <button type="submit" name="delete_artist" class="btn btn-danger" onclick="return confirm('Delete {{ artist.username }} and all their tasks?');">Delete</button>
                </form>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="9" style="text-align:center; padding:18px;">No artists yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const statusSelect = document.getElementById('status_filter');
    if (statusSelect) {
      statusSelect.addEventListener('change', () => {
        statusSelect.form.submit();
      });
    }
  });
</script>

{% endblock %}





