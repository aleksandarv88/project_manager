{% extends 'core/info_base.html' %}

{% block title %}Asset Info{% endblock %}

{% block content %}
<h1>Asset Info</h1>

<div class="info-layout">
  <div class="info-panel info-profile-panel">
    <div class="info-avatar-wrapper">
      {% if asset.image %}
        <img src="{{ asset.image.url }}" alt="{{ asset.name }}">
      {% else %}
        <div style="width:100%; height:260px; display:flex; align-items:center; justify-content:center; background:#4c4c4c; color:#fff; font-size:48px; font-weight:600;">
          {{ asset.name|slice:':1'|upper }}
        </div>
      {% endif %}
      <span class="info-status-tag info-status-{{ asset.status }}">{{ asset.get_status_display|default:asset.status|title }}</span>
    </div>
    <h2>{{ asset.name }}</h2>
    {% if asset.code %}<p class="info-meta-pill">Code: {{ asset.code }}</p>{% endif %}
    <p class="info-meta-pill">Project: <a href="{% url 'project_info' asset.project.id %}">{{ asset.project.name }}</a></p>
    <p class="info-meta-pill">Type: {{ asset.get_asset_type_display|default:asset.asset_type|title }}</p>
    {% if asset.pipeline_step %}<p class="info-meta-pill">Pipeline Step: {{ asset.pipeline_step }}</p>{% endif %}
    {% if asset.fps %}<p class="info-meta-pill">Native FPS: {{ asset.fps }}</p>{% endif %}
    {% if asset.frame_start and asset.frame_end %}
    <p class="info-meta-pill">Frames: {{ asset.frame_start }} → {{ asset.frame_end }}</p>
    {% endif %}
    <div class="info-profile-meta">
      <div>
        <div class="info-meta-label">Category</div>
        <div class="info-meta-value">{{ asset.category|default:'-' }}</div>
      </div>
      <div>
        <div class="info-meta-label">Subtype</div>
        <div class="info-meta-value">{{ asset.subtype|default:'-' }}</div>
      </div>
      <div>
        <div class="info-meta-label">Created</div>
        <div class="info-meta-value">{{ asset.created_at|date:'Y-m-d H:i' }}</div>
      </div>
      <div>
        <div class="info-meta-label">Updated</div>
        <div class="info-meta-value">{{ asset.updated_at|date:'Y-m-d H:i' }}</div>
      </div>
    </div>
    {% if asset.description %}
    <div class="info-section">
      <h3>Description</h3>
      <p>{{ asset.description }}</p>
    </div>
    {% endif %}

    <div class="info-section">
      <h3>Assigned Artists</h3>
      <ul class="info-list">
        {% for item in asset.assigned_artists_with_departments %}
          <li>{{ item.username }} ({{ item.department|upper }})</li>
        {% empty %}
          <li>No artists assigned.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="info-panel info-form-panel">
    <h2>Edit Asset</h2>
    <form method="post" enctype="multipart/form-data" class="info-form">
      {% csrf_token %}
      {% for field in form %}
        <div class="info-field-row">
          {{ field.label_tag }}
          {{ field }}
          {% if field.errors %}
            <div class="info-field-errors">
              {% for error in field.errors %}{{ error }}<br>{% endfor %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
      <div class="info-profile-actions">
        <button type="submit" class="info-btn info-btn-secondary">Save Changes</button>
        <a href="{% url 'asset_list' %}" class="info-btn info-btn-danger">Back</a>
      </div>
    </form>

    <div class="info-section" style="margin-top: 24px;">
      <h3>Versions</h3>
      {% if versions %}
        <form method="get" style="margin-bottom: 12px;">
          <label for="version">Select Version</label>
          <select id="version" name="version" onchange="this.form.submit()">
            {% for version in versions %}
              <option value="{{ version.id }}" {% if selected_version and selected_version.id == version.id %}selected{% endif %}>
                v{{ version.version|stringformat:"03d" }} - {{ version.registered_at|date:'Y-m-d H:i' }}
              </option>
            {% endfor %}
          </select>
        </form>

        {% if selected_version %}
          <div class="info-profile-meta">
            <div><div class="info-meta-label">fbx_name</div><div class="info-meta-value">{{ selected_version.fbx_name }}</div></div>
            <div><div class="info-meta-label">qc_status</div><div class="info-meta-value">{{ selected_version.get_qc_status_display }}</div></div>
            <div><div class="info-meta-label">status</div><div class="info-meta-value">{{ selected_version.get_status_display }}</div></div>
            <div><div class="info-meta-label">registered_by</div><div class="info-meta-value">{{ selected_version.registered_by|default:"-" }}</div></div>
            <div><div class="info-meta-label">asset_type</div><div class="info-meta-value">{{ selected_version.get_asset_type_display }}</div></div>
            <div><div class="info-meta-label">asset_category</div><div class="info-meta-value">{{ selected_version.get_asset_category_display }}</div></div>
            <div><div class="info-meta-label">skeleton_type</div><div class="info-meta-value">{{ selected_version.get_skeleton_type_display }}</div></div>
            <div><div class="info-meta-label">pose_type</div><div class="info-meta-value">{{ selected_version.get_pose_type_display }}</div></div>
            <div><div class="info-meta-label">deform_type</div><div class="info-meta-value">{{ selected_version.get_deform_type_display }}</div></div>
            <div><div class="info-meta-label">units</div><div class="info-meta-value">{{ selected_version.units }}</div></div>
            <div><div class="info-meta-label">scale_to_canonical</div><div class="info-meta-value">{{ selected_version.scale_to_canonical }}</div></div>
            <div><div class="info-meta-label">height_cm</div><div class="info-meta-value">{{ selected_version.height_cm|default:"-" }}</div></div>
            <div><div class="info-meta-label">gender</div><div class="info-meta-value">{{ selected_version.get_gender_display|default:"-" }}</div></div>
            <div><div class="info-meta-label">age_group</div><div class="info-meta-value">{{ selected_version.get_age_group_display|default:"-" }}</div></div>
            <div><div class="info-meta-label">body_type</div><div class="info-meta-value">{{ selected_version.get_body_type_display|default:"-" }}</div></div>
            <div><div class="info-meta-label">role_tag</div><div class="info-meta-value">{{ selected_version.get_role_tag_display|default:"-" }}</div></div>
            <div><div class="info-meta-label">role_text</div><div class="info-meta-value">{{ selected_version.role_text|default:"-" }}</div></div>
            <div><div class="info-meta-label">qc_report_path</div><div class="info-meta-value">{{ selected_version.qc_report_path|default:"-" }}</div></div>
          </div>
          <div class="info-section">
            <h3>Paths</h3>
            <p><strong>fbx_path:</strong> <code>{{ selected_version.fbx_path }}</code></p>
            <p><strong>textures_path:</strong> <code>{{ selected_version.textures_path }}</code></p>
          </div>
          <div class="info-section">
            <h3>Textures</h3>
            <ul class="info-list">
              {% for texture in selected_version.textures.all %}
                <li><code>{{ texture.texture_name }}</code> - <code>{{ texture.texture_path }}</code></li>
              {% empty %}
                <li>No texture files registered.</li>
              {% endfor %}
            </ul>
          </div>
          {% if selected_version.notes %}
            <div class="info-section">
              <h3>Notes</h3>
              <p>{{ selected_version.notes }}</p>
            </div>
          {% endif %}
        {% endif %}
      {% else %}
        <p>No registered versions yet.</p>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
