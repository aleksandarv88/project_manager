{% extends 'core/info_base.html' %}

{% block title %}Sequence Info{% endblock %}

{% block content %}
<h1>Sequence Info</h1>

<div class="info-layout">
  <div class="info-panel info-profile-panel">
    <div class="info-avatar-wrapper">
      {% if sequence.image %}
        <img src="{{ sequence.image.url }}" alt="{{ sequence.name }}">
      {% else %}
        <div style="width:100%; height:260px; display:flex; align-items:center; justify-content:center; background:#404048; color:#fff; font-size:48px; font-weight:600;">
          {{ sequence.name|slice:':1'|upper }}
        </div>
      {% endif %}
      <span class="info-status-tag info-status-{{ sequence.status }}">{{ sequence.get_status_display|default:sequence.status|title }}</span>
    </div>
    <h2>{{ sequence.name }}</h2>
    {% if sequence.code %}<p class="info-meta-pill">Code: {{ sequence.code }}</p>{% endif %}
    <p class="info-meta-pill">Project: <a href="{% url 'project_info' sequence.project.id %}">{{ sequence.project.name }}</a></p>
    <p class="info-meta-pill">Frames: {{ sequence.frame_start }} → {{ sequence.frame_end }} (handles {{ sequence.handles }})</p>
    <p class="info-meta-pill">FPS: {{ sequence.fps }}</p>
    <p class="info-meta-pill">Resolution: {{ sequence.resolution_width }} x {{ sequence.resolution_height }}</p>
    <div class="info-profile-meta">
      <div>
        <div class="info-meta-label">Color Space</div>
        <div class="info-meta-value">{{ sequence.color_space|default:sequence.project.color_space }}</div>
      </div>
      <div>
        <div class="info-meta-label">Created</div>
        <div class="info-meta-value">{{ sequence.created_at|date:'Y-m-d H:i' }}</div>
      </div>
      <div>
        <div class="info-meta-label">Updated</div>
        <div class="info-meta-value">{{ sequence.updated_at|date:'Y-m-d H:i' }}</div>
      </div>
    </div>
    {% if sequence.description %}
    <div class="info-section">
      <h3>Description</h3>
      <p>{{ sequence.description }}</p>
    </div>
    {% endif %}

    <div class="info-section">
      <h3>Shots ({{ shots|length }})</h3>
      <ul class="info-list">
        {% for shot in shots %}
          <li><a href="{% url 'shot_info' shot.id %}">{{ shot.code|default:shot.name }}</a> — {{ shot.status|title }}</li>
        {% empty %}
          <li>No shots yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="info-panel info-form-panel">
    <h2>Edit Sequence</h2>
    <form method="post" enctype="multipart/form-data" class="info-form">
      {% csrf_token %}
      {% for field in form %}
        <div class="info-field-row">
          {{ field.label_tag }}
          {{ field }}
          {% if field.errors %}
            <div class="info-field-errors">
              {% for error in field.errors %}{{ error }}<br>{% endfor %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
      <div class="info-profile-actions">
        <button type="submit" class="info-btn info-btn-secondary">Save Changes</button>
        <a href="{% url 'sequence_list' %}" class="info-btn info-btn-danger">Back</a>
      </div>
    </form>
  </div>
</div>

<div class="info-wide-panels">
  <div class="info-panel">
    <h2>Active Tasks</h2>
    <ul class="info-list">
      {% for task in tasks %}
        <li>{{ task.task_name|default:task.task_type }} — {{ task.status|title }}{% if task.artist %} · {{ task.artist.username }}{% endif %}{% if task.shot %} · <a href="{% url 'shot_info' task.shot.id %}">{{ task.shot.code|default:task.shot.name }}</a>{% endif %}</li>
      {% empty %}
        <li>No tasks yet.</li>
      {% endfor %}
    </ul>
  </div>
  <div class="info-panel">
    <h2>Recent Publishes</h2>
    <ul class="info-list">
      {% for publish in publishes %}
        <li>
          <strong>
            {% if publish.label %}
              {{ publish.label }}
            {% else %}
              #{{ publish.id }}{% if publish.source_version or publish.source_iteration %} (H {{ publish.source_version|default:0|stringformat:"03d" }}.{{ publish.source_iteration|default:0|stringformat:"03d" }}){% endif %}
            {% endif %}
          </strong>
          {% if publish.task %} · Task {{ publish.task.task_name|default:publish.task.task_type }}{% endif %}
          {% if publish.created_by %} · {{ publish.created_by.username }}{% endif %}
          · {{ publish.published_at|date:'Y-m-d H:i' }}
        </li>
      {% empty %}
        <li>No publishes yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>

{% endblock %}
